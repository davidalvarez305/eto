{% extends "blog/base.html" %}
{% load static %}
{% block content %}
<div class="space-y-4 dark:text-gray-100 lg:space-y-8">
    <!-- Quote Request -->
    <div class="flex flex-col overflow-hidden rounded-lg bg-white shadow-sm dark:bg-gray-800 dark:text-gray-100">
        <div class="grow p-5 md:flex lg:p-8">
            <div class="mb-5 border-b border-gray-200 dark:border-gray-700 md:mb-0 md:w-1/3 md:flex-none md:border-0">
                <h3 class="mb-1 flex items-center justify-start gap-2 font-semibold">
                    <svg class="hi-mini hi-user-circle inline-block size-5 text-blue-500"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-5.5-2.5a2.5 2.5 0 11-5 0 2.5 2.5 0 015 0zM10 12a5.99 5.99 0 00-4.793 2.39A6.483 6.483 0 0010 16.5a6.483 6.483 0 004.793-2.11A5.99 5.99 0 0010 12z"
                            clip-rule="evenodd" />
                    </svg>
                    <span>Quote Request</span>
                </h3>
                <p class="mb-5 text-sm text-gray-500 dark:text-gray-400">
                    Lead's quote request details.
                </p>
            </div>
            <div class="md:w-2/3 md:pl-24">
                <form id="leadForm" class="space-y-6 xl:w-2/3" action="/leads/{{ lead.id }}">
                    <input type="hidden" name="_method" value="PUT" />
                    {% csrf_token %}
                    <input type="hidden" id="lead_id" name="lead_id" value="{{ lead.id }}" />
                    <div class="space-y-6 sm:flex sm:gap-3 sm:space-y-0">
                        <div class="grow space-y-1">
                            <label for="first_name" class="font-medium">First Name*</label>
                            <input type="text" id="first_name" name="first_name" value="{{ lead.first_name }}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                        <div class="grow space-y-1">
                            <label for="last_name" class="font-medium">Last Name*</label>
                            <input type="text" id="last_name" name="last_name" value="{{ lead.last_name }}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label for="phone_number" class="font-medium">Phone Number*</label>
                        <input type="tel" id="phone_number" name="phone_number" value="{{ lead.phone_number }}"
                            class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                    </div>
                    <div class="space-y-1">
                        <label for="service_id" class="font-medium">Service</label>
                        <select id="service_id" name="service_id" required
                            class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 focus:border-blue focus:ring focus:ring-blue focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:focus:border-blue">
                            {% for service in services %}
                                <option value="{{ service.id }}" {% if service.id == lead.service_id %}selected{% endif %}>
                                    {{ service.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label for="location_id" class="font-medium">Location</label>
                        <select id="location_id" name="location_id" required
                            class="block w-full rounded-lg border border-gray-200 px-5 py-3 leading-6 focus:border-blue focus:ring focus:ring-blue focus:ring-opacity-50 dark:border-gray-600 dark:bg-gray-800 dark:focus:border-blue">
                            {% for location in locations %}
                                <option value="{{ location.id }}" {% if location.id == lead.location_id %}selected{% endif %}>
                                    {{ location.name }}
                                </option>
                            {% endfor %}
                        </select>
                    </div>
                    <button type="submit"
                        class="inline-flex items-center justify-center gap-2 rounded-lg border border-blue-700 bg-blue-700 px-3 py-2 text-sm font-semibold leading-5 text-white hover:border-blue-600 hover:bg-blue-600 hover:text-white focus:ring focus:ring-blue-400/50 active:border-blue-700 active:bg-blue-700 dark:focus:ring-blue-400/90">
                        Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- END Quote Request -->

    <!-- Lead Marketing -->
    <div class="flex flex-col overflow-hidden rounded-lg bg-white shadow-sm dark:bg-gray-800 dark:text-gray-100">
        <div class="grow p-5 md:flex lg:p-8">
            <div class="mb-5 border-b border-gray-200 dark:border-gray-700 md:mb-0 md:w-1/3 md:flex-none md:border-0">
                <h3 class="mb-1 flex items-center justify-start gap-2 font-semibold">
                    <svg class="hi-mini hi-credit-card inline-block size-5 text-blue-500"
                        xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                        <path fill-rule="evenodd"
                            d="M2.5 4A1.5 1.5 0 001 5.5V6h18v-.5A1.5 1.5 0 0017.5 4h-15zM19 8.5H1v6A1.5 1.5 0 002.5 16h15a1.5 1.5 0 001.5-1.5v-6zM3 13.25a.75.75 0 01.75-.75h1.5a.75.75 0 010 1.5h-1.5a.75.75 0 01-.75-.75zm4.75-.75a.75.75 0 000 1.5h3.5a.75.75 0 000-1.5h-3.5z"
                            clip-rule="evenodd" />
                    </svg>
                    <span>Marketing</span>
                </h3>
                <p class="mb-5 text-sm text-gray-500 dark:text-gray-400">
                    All marketing details related to this lead.
                </p>
            </div>
            <div class="md:w-2/3 md:pl-24">
                <form id="leadMarketingForm" action="/leads/{{ lead.marketing.id }}/marketing" class="space-y-6 xl:w-2/3">
                    {% csrf_token %}
                    <input type="hidden" id="lead_id" name="lead_id" value="{{ lead.id }}" />
                    <input type="hidden" name="_method" value="PUT" />
                    <div class="space-y-1">
                        <label for="campaign_name" class="font-medium">Campaign Name</label>
                        <input type="text" id="campaign_name" name="campaign_name" value="{{ lead.marketing.ad_campaign }}"
                            class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                    </div>
                    <div class="space-y-6 sm:flex sm:gap-3 sm:space-y-0">
                        <div class="grow space-y-1">
                            <label for="medium" class="font-medium">Medium</label>
                            <input type="text" id="medium" name="medium" value="{{ lead.marketing.medium }}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                        <div class="grow space-y-1">
                            <label for="source" class="font-medium">Source</label>
                            <input type="text" id="source" name="source" value="{{ lead.marketing.source }}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                    </div>
                    <div class="space-y-1">
                        <label for="referrer" class="font-medium">Referrer</label>
                        <input type="text" id="referrer" name="referrer" value="{{ lead.marketing.referrer }}"
                            class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                    </div>
                    <div class="space-y-1">
                        <label for="landing_page" class="font-medium">Landing Page</label>
                        <input type="text" id="landing_page" name="landing_page" value="{{ lead.marketing.landing_page }}"
                            class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                    </div>
                    <div class="space-y-6 sm:flex sm:gap-3 sm:space-y-0">
                        <div class="space-y-1 sm:w-2/3">
                            <label for="ip" class="font-medium">IP</label>
                            <input type="text" id="ip" name="ip" value="{{ lead.marketing.ip }}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                        <div class="space-y-1 sm:w-1/3">
                            <label for="keyword" class="font-medium">Keyword</label>
                            <input type="text" id="keyword" name="keyword" value="{{ lead.marketing.keyword}}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                    </div>
                    <div class="space-y-6 sm:flex sm:gap-3 sm:space-y-0">
                        <div class="grow space-y-1">
                            <label for="channel" class="font-medium">Channel</label>
                            <input type="text" id="channel" name="channel" value="{{ lead.marketing.channel}}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                        <div class="grow space-y-1">
                            <label for="language" class="font-medium">Language</label>
                            <input type="text" id="language" name="language" value="{{ lead.marketing.language }}"
                                class="block w-full rounded-lg border border-gray-200 px-3 py-2 leading-6 placeholder-gray-500 focus:border-blue-500 focus:ring focus:ring-blue-500/50 dark:border-gray-600 dark:bg-gray-800 dark:placeholder-gray-400 dark:focus:border-blue-500" />
                        </div>
                    </div>
                    <button type="submit"
                        class="inline-flex items-center justify-center gap-2 rounded-lg border border-blue-700 bg-blue-700 px-3 py-2 text-sm font-semibold leading-5 text-white hover:border-blue-600 hover:bg-blue-600 hover:text-white focus:ring focus:ring-blue-400/50 active:border-blue-700 active:bg-blue-700 dark:focus:ring-blue-400/90">
                        Save Changes
                    </button>
                </form>
            </div>
        </div>
    </div>
    <!-- END Lead Marketing -->
</div>

<script nonce="{{ .Nonce }}">
    function handleLeadSaveChanges(event) {
        event.preventDefault();

        var body = new FormData(event.target);
        const endpoint = event.target.action;
        const method = event.target.method === "get" ? body.get('_method') : event.target.method;

        fetch(endpoint, {
            method: method,
            credentials: "include",
            body: body,
        })
        .then((response) => {
            if (response.ok) {
                return response.text();
            } else {
                return response.text().then((err) => {
                    throw new Error(err);
                });
            }
        })
        .catch(console.error);
    }
</script>
{% endblock %}